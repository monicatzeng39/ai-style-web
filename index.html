<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>ç…§ç‰‡ â†’ æº«æš–æŸ”å…‰ç¾åœ–é¢¨æ ¼</title>
  <style>
    body {
      font-family: system-ui, "Microsoft JhengHei";
      text-align: center;
      padding: 40px 20px;
    }
    h1 { font-size: 30px; margin-bottom: 10px; }
    p { color: #555; }
    #container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 40px;
      margin-top: 30px;
    }
    .box {
      width: 320px;
    }
    img {
      width: 100%;
      border-radius: 16px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.12);
      object-fit: cover;
    }
    button {
      margin-top: 16px;
      padding: 10px 18px;
      border-radius: 999px;
      border: none;
      background: #ff8ab3;
      color: #fff;
      font-size: 16px;
      cursor: pointer;
    }
    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    #status {
      margin-top: 10px;
      color: #666;
    }
  </style>
</head>

<body>
  <h1>ğŸ“¸ ç…§ç‰‡ â†’ æº«æš–æŸ”å…‰ç¾åœ–é¢¨æ ¼</h1>
  <p>1. ä¸Šå‚³ä¸€å¼µç…§ç‰‡ã€€2. æŒ‰ä¸‹ã€Œç”¢ç”Ÿé¢¨æ ¼åœ–ã€ã€€3. ä¸‹è¼‰å³é‚Šçš„çµæœå³å¯</p>

  <input type="file" id="upload" accept="image/*">

  <div id="container">
    <div class="box">
      <h2>åŸå§‹åœ–ç‰‡</h2>
      <img id="preview" alt="åŸå§‹åœ–ç‰‡å°‡é¡¯ç¤ºåœ¨é€™è£¡">
    </div>
    <div class="box">
      <h2>é¢¨æ ¼å¾Œåœ–ç‰‡ï¼ˆæº«æš–æŸ”å…‰ï¼‰</h2>
      <img id="result" alt="é¢¨æ ¼å¾Œåœ–ç‰‡å°‡é¡¯ç¤ºåœ¨é€™è£¡">
    </div>
  </div>

  <button id="genBtn">ç”¢ç”Ÿé¢¨æ ¼åœ–</button>
  <div id="status"></div>

  <script>
    const upload = document.getElementById("upload");
    const previewImg = document.getElementById("preview");
    const resultImg = document.getElementById("result");
    const genBtn = document.getElementById("genBtn");
    const statusDiv = document.getElementById("status");

    let originalDataUrl = null;

    // ä¸Šå‚³æ™‚é è¦½
    upload.addEventListener("change", function () {
      const file = this.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function (e) {
        originalDataUrl = e.target.result;
        previewImg.src = originalDataUrl;
        resultImg.src = "";
        statusDiv.textContent = "";
      };
      reader.readAsDataURL(file);
    });

    // ç”¢ç”Ÿæº«æš–æŸ”å…‰é¢¨æ ¼
    genBtn.addEventListener("click", function () {
      if (!originalDataUrl) {
        alert("è«‹å…ˆé¸æ“‡ä¸€å¼µç…§ç‰‡ï¼");
        return;
      }

      statusDiv.textContent = "è™•ç†ä¸­â€¦";
      genBtn.disabled = true;

      const img = new Image();
      img.onload = function () {
        const canvas = document.createElement("canvas");
        const ctx = canvas.getContext("2d");
        canvas.width = img.width;
        canvas.height = img.height;

        // 1. å…ˆç•«åŸåœ–
        ctx.drawImage(img, 0, 0);

        // 2. æŸ”å…‰å±¤ï¼ˆæ•´é«”æŸ”å’Œï¼‰
        ctx.globalCompositeOperation = "soft-light";
        ctx.fillStyle = "rgba(255, 200, 170, 0.35)"; // æš–æ©˜æŸ”å…‰
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // 3. åŠ äº®ä¸€é»é»
        ctx.globalCompositeOperation = "screen";
        ctx.fillStyle = "rgba(255,255,255,0.20)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // 4. è†šè‰²å¾®æš–ï¼Œåæ—¥ç³»
        ctx.globalCompositeOperation = "color";
        ctx.fillStyle = "rgba(255,180,140,0.25)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // 5. å›åˆ°æ­£å¸¸åˆæˆï¼Œé¿å…å¾Œé¢æ“ä½œå‡ºéŒ¯
        ctx.globalCompositeOperation = "source-over";

        const outDataUrl = canvas.toDataURL("image/jpeg", 0.95);
        resultImg.src = outDataUrl;
        statusDiv.textContent = "å®Œæˆ âœ¨ï¼ˆé•·æŒ‰æˆ–å³éµå³å¯å­˜åœ–ï¼‰";
        genBtn.disabled = false;
      };
      img.src = originalDataUrl;
    });
  </script>
</body>
</html>
